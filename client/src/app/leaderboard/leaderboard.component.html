<div class="main-container">
  <div class="container">
    <section class="leaderboard">
      <div class="header">
        <div>
          <h2>Leaderboard</h2>
          <p class="subtitle">
            Top performers in our FavourFlow community
          </p>

        </div>

      </div>

      <div class="leaderboard-top3">
        @for (user of top3User$ | async; track user.userName) {
        <mat-card class="user-card" [ngClass]="{
            first: user.rank === 1,
            second: user.rank === 2,
            third: user.rank === 3
          }">
          <div class="rank-badge">
            <span>{{ user.rank }}</span>
          </div>

          <div class="avatar-container">
            <img [src]="user.avatar" [alt]="user.firstName" class="avatar" />
          </div>

          <div class="info">

            <h3>{{ user.firstName }} {{ user.lastName }}</h3>
            <p class="username">{{ user.userName }}</p>
          </div>
          <div class="stats" >
            <div >
              <span class="completed">{{ user.completedCount }}</span>
              <span>Completed</span>
            </div>
            <div>
              <span class="score">{{ user.points }}</span>
              <span>Score</span>
            </div>
          </div>
        </mat-card>
        }
      </div>




    </section>

    <mat-card class="rankings" style="background: #fff; margin-top: 40px;">
      <mat-card-header style="padding:20px">
        <mat-card-title style="font-weight: 500;">Full Ranking</mat-card-title>
      </mat-card-header>
      <mat-divider style="color: red;"></mat-divider>

      <!-- TABLE (desktop/tablet only) -->
      <div class="table-responsive desktop-view">
        <table mat-table [dataSource]="(menuItems$ | async)?.items || []" class="leaderboard-table">
          <!-- Rank -->
          <ng-container matColumnDef="rank">
            <th mat-header-cell *matHeaderCellDef> Rank </th>
            <td mat-cell *matCellDef="let user">{{ user.rank }}</td>
          </ng-container>

          <!-- User -->
          <ng-container matColumnDef="user">
            <th mat-header-cell *matHeaderCellDef> User </th>
            <td mat-cell *matCellDef="let user">
              <div class="user-info">
                <img [src]="user.avatar" class="small-avatar" />
                <div>
                  <p class="fullname">{{ user.firstName }} {{ user.lastName }}</p>
                  <div>{{ '@' + user.userName }}</div>
                </div>
              </div>
            </td>
          </ng-container>

          <!-- Completed -->
          <ng-container matColumnDef="completed">
            <th mat-header-cell *matHeaderCellDef> Completed </th>
            <td mat-cell *matCellDef="let user">{{ user.completedCount }}</td>
          </ng-container>

          <!-- Score -->
          <ng-container matColumnDef="score">
            <th mat-header-cell *matHeaderCellDef> Score </th>
            <td mat-cell *matCellDef="let user">{{ user.points }}</td>
          </ng-container>

          <!-- Header + Rows -->
          <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
          <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
        </table>
      </div>

      <!-- CARD VIEW (mobile only) -->
      <div class="mobile-view">
        <div class="user-card-2" *ngFor="let user of (menuItems$ | async)?.items || []">
          <div class="card-header">
            <span class="rank-badge rank-badge-2">{{ user.rank }}</span>
          </div>
          <div class="user-info">
            <img [src]="user.avatar" class="small-avatar" />
            <div>
              <p class="fullname">{{ user.firstName }} {{ user.lastName }}</p>
              <div>{{ '@' + user.userName }}</div>
            </div>
          </div>
          <div class="stats">
            <div>
              <span>{{ user.completedCount }}</span>
              <div class="completed">Completed</div>
            </div>
            <div>
              <span>{{ user.points }}</span>
              <div class="score">Score</div>
            </div>
          </div>
        </div>
      </div>
    </mat-card>

    <mat-paginator [length]="(menuItems$ | async)?.totalItems || 0" [pageSize]="10" [pageSizeOptions]="[5, 10, 20]"
      style="margin-top: 10px;" [pageIndex]="((menuItems$ | async)?.currentPage || 1) - 1"
      (page)="onPageChange($event)">
    </mat-paginator>
  </div>
</div>
